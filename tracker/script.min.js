let n=null,i=null,l=null,a=null;typeof document<"u"&&(n=document.querySelector(`script[src^="${import.meta.url}"]`),i=n?.getAttribute("data-api")||n&&`${new URL(n.src).origin}/api/event`,l=n?.getAttribute("data-entity")||null,a=document.referrer);const c=/^localhost$|^127(\.[0-9]+){0,2}\.[0-9]+$|^\[::1?\]$/,d=t=>console.info(`[liwan]: ${t}`),o=t=>d(`Ignoring event: ${t}`);async function p(t="pageview",e){return typeof window>"u"&&!e?.endpoint?Promise.reject(new Error("endpoint is required in server-side environments")):typeof localStorage<"u"&&localStorage.getItem("disable-liwan")?o("localStorage flag"):c.test(location.hostname)||location.protocol==="file:"?o("localhost"):!i&&!e?.endpoint?o("no endpoint"):fetch(e?.endpoint||i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_id:e?.entity||l,name:t,referrer:e?.referrer||a,url:e?.url||`${location.origin}${location.pathname}`})}).then(r=>(r.ok||d(`Failed to send event: ${r.statusText}`),{status:r.status}))}const g=()=>{window.__liwan_loaded=!0;let t;const e=()=>{t!==location.pathname&&(t=location.pathname,p("pageview"))};window.history.pushState&&(window.history.pushState=new Proxy(window.history.pushState,{apply:(r,s,u)=>{r.apply(s,u),e()}}),window.addEventListener("popstate",e)),e()};typeof window<"u"&&!window.__liwan_loaded&&n&&g();export{p as event};
