let n=null,i=null,a=null,l=null;typeof document<"u"&&(n=document.querySelector(`script[src^="${import.meta.url}"]`),i=n?.getAttribute("data-api")||n&&`${new URL(n.src).origin}/api/event`,a=n?.getAttribute("data-entity")||null,l=document.referrer);const u=/^localhost$|^127(\.[0-9]+){0,2}\.[0-9]+$|^\[::1?\]$/,s=t=>console.info(`[liwan]: ${t}`),o=t=>s(`Ignoring event: ${t}`);async function c(t="pageview",e){return typeof window>"u"&&!e?.endpoint?Promise.reject(new Error("endpoint is required in server-side environments")):typeof localStorage<"u"&&localStorage.getItem("disable-liwan")?o("localStorage flag"):u.test(location.hostname)||location.protocol==="file:"?o("localhost"):!i&&!e?.endpoint?o("no endpoint"):fetch(e?.endpoint||i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_id:e?.entity||a,name:t,referrer:e?.referrer||l,url:e?.url||`${location.origin}${location.pathname}`})}).then(r=>(r.ok||s(`Failed to send event: ${r.statusText}`),{status:r.status}))}const g=()=>{window.__liwan_loaded=!0;let t;const e=()=>{t!==location.pathname&&(t=location.pathname,c("pageview"))};if(history.pushState){const r=history.pushState;history.pushState=(...d)=>{r(...d),e()},window.addEventListener("popstate",e)}e()};typeof window<"u"&&!window.__liwan_loaded&&n&&g();export{c as event};
