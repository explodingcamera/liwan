let r=null,i=null,a=null;typeof document<"u"&&(r=document.currentScript,i=r?.getAttribute("data-api")||r&&`${new URL(r.src).origin}/api/event`,a=document.referrer);const s=/^localhost$|^127(\.[0-9]+){0,2}\.[0-9]+$|^\[::1?\]$/,o=t=>console.info(`[liwan]: ignoring event: ${t}`);async function d(t="pageview",e){return typeof window>"u"&&!e?.endpoint?Promise.reject(new Error("endpoint is required in server-side environments")):typeof localStorage<"u"&&localStorage.getItem("disable-liwan")?o("localStorage flag"):s.test(location.hostname)||location.protocol==="file:"?o("localhost"):!i&&!e?.endpoint?o("no endpoint"):fetch(e?.endpoint||i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,referrer:e?.referrer||a,url:e?.url||`${location.origin}${location.pathname}`})}).then(n=>(n.ok||console.error("[liwan]: failed to send event: ",n),{status:n.status}))}const u=()=>{window.__liwan_loaded=!0;let t;const e=()=>{t!==location.pathname&&(t=location.pathname,d("pageview"))};if(history.pushState){const n=history.pushState;history.pushState=(...l)=>{n(...l),e()},window.addEventListener("popstate",e)}e()};typeof window<"u"&&!window.__liwan_loaded&&r&&u();export{d as event};
