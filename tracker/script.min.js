const a=/^localhost$|^127(\.[0-9]+){0,2}\.[0-9]+$|^\[::1?\]$/,r=document?.currentScript,l=r?.getAttribute("data-api")||r&&`${new URL(r.src).origin}/api/event`,o=e=>console.info(`[liwan]: ignoring event: ${e}`);async function s(e,t){return localStorage.getItem("disable-analytics")?o("localStorage flag"):a.test(location.hostname)||location.protocol==="file:"?o("localhost"):fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,referrer:t?.overrideReferrer||document.referrer,url:t?.overrideUrl||`${location.origin}${location.pathname}`})}).then(n=>(n.ok||console.error("[liwan]: failed to send event: ",n),{status:n.status}))}const c=()=>{if(window.__liwan_loaded)return;window.__liwan_loaded=!0;let e;const t=()=>{e!==location.pathname&&(e=location.pathname,s("pageview"))};if(history.pushState){const n=history.pushState;history.pushState=(...i)=>{n(...i),t()},window.addEventListener("popstate",t)}t()};!window.__liwan_loaded&&r?c():console.info("[liwan]: already loaded, skipping pageview tracking");export{s as event};
