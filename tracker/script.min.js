let n=null,r=null,a=null,l=null;typeof document<"u"&&(n=document.querySelector(`script[src^="${import.meta.url}"]`),r=n?.getAttribute("data-api")||n&&`${new URL(n.src).origin}/api/event`,a=n?.getAttribute("data-entity")||null,l=document.referrer);const g=/^localhost$|^127(\.[0-9]+){0,2}\.[0-9]+$|^\[::1?\]$/,d=t=>console.info(`[liwan]: ${t}`),o=t=>d(`Ignoring event: ${t}`);async function c(t="pageview",e){return typeof window>"u"&&!e?.endpoint?Promise.reject(new Error("endpoint is required in server-side environments")):typeof localStorage<"u"&&localStorage.getItem("disable-liwan")?o("localStorage flag"):g.test(location.hostname)||location.protocol==="file:"?o("localhost"):!r&&!e?.endpoint?o("no endpoint"):fetch(e?.endpoint||r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_id:e?.entity||a,name:t,referrer:e?.referrer||l,url:e?.url||`${location.origin}${location.pathname}`})}).then(i=>(i.ok||d(`Failed to send event: ${i.statusText}`),{status:i.status}))}const p=()=>{window.__liwan_loaded=!0;let t;const e=()=>{t!==location.pathname&&(t=location.pathname,c("pageview"))};window.navigation?window.navigation.addEventListener("navigate",()=>e()):(window.history.pushState=new Proxy(window.history.pushState,{apply:(i,s,u)=>{i.apply(s,u),e()}}),window.addEventListener("popstate",e),document.addEventListener("astro:page-load",()=>e())),e()};typeof window<"u"&&!window.__liwan_loaded&&n&&p();export{c as event};
