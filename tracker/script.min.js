let n=null,a=null,l=null,s=null;const u=typeof window>"u";typeof document<"u"&&(n=document.querySelector(`script[src^="${import.meta.url}"]`),a=n?.getAttribute("data-api")||n&&new URL(n.src).origin+"/api/event",l=n?.getAttribute("data-entity")||null,s=document.referrer);const d=e=>console.info("[liwan]: "+e),c=e=>d("Ignoring event: "+e),g=e=>{throw new Error("Failed to send event: "+e)};async function p(e="pageview",t){const r=t?.endpoint||a;if(!r)return g("endpoint is required");if(typeof localStorage<"u"&&localStorage.getItem("disable-liwan"))return c("localStorage flag");if(/^localhost$|^127(?:\.\d+){0,2}\.\d+$|^\[::1?\]$/.test(location.hostname)||location.protocol==="file:")return c("localhost");const i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,entity_id:t?.entity||l,referrer:t?.referrer||s,url:t?.url||location.origin+location.pathname,utm:{...["campaign","content","medium","source","term"].map(o=>[o,new URLSearchParams(location.search).get("utm_"+o)])}})});i.ok||(d("Failed to send event: "+i.statusText),g(i.statusText))}const w=()=>{window.__liwan_loaded=!0;let e;const t=()=>{e!==location.pathname&&(e=location.pathname,p("pageview"))};window.navigation?window.navigation.addEventListener("navigate",()=>t()):(window.history.pushState=new Proxy(window.history.pushState,{apply:(r,i,o)=>{r.apply(i,o),t()}}),window.addEventListener("popstate",t),document.addEventListener("astro:page-load",()=>t())),t()};!u&&!window.__liwan_loaded&&n&&w();export{p as event};
