let i=null,o=null,l=null,d=null;typeof document<"u"&&(i=document.querySelector(`script[src^="${import.meta.url}"]`),o=i?.getAttribute("data-api")||i&&`${new URL(i.src).origin}/api/event`,l=i?.getAttribute("data-entity")||null,d=document.referrer);const g=/^localhost$|^127(\.[0-9]+){0,2}\.[0-9]+$|^\[::1?\]$/,s=t=>console.info(`[liwan]: ${t}`),a=t=>s(`Ignoring event: ${t}`);async function c(t="pageview",e){if(typeof window>"u"&&!e?.endpoint)return Promise.reject(new Error("endpoint is required in server-side environments"));if(typeof localStorage<"u"&&localStorage.getItem("disable-liwan"))return a("localStorage flag");if(g.test(location.hostname)||location.protocol==="file:")return a("localhost");if(!o&&!e?.endpoint)return a("no endpoint");const n=new URLSearchParams(location.search);return fetch(e?.endpoint||o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_id:e?.entity||l,name:t,referrer:e?.referrer||d,url:e?.url||`${location.origin}${location.pathname}`,utm:{campaign:n.get("utm_campaign"),content:n.get("utm_content"),medium:n.get("utm_medium"),source:n.get("utm_source"),term:n.get("utm_term")}})}).then(r=>(r.ok||s(`Failed to send event: ${r.statusText}`),{status:r.status}))}const p=()=>{window.__liwan_loaded=!0;let t;const e=()=>{t!==location.pathname&&(t=location.pathname,c("pageview"))};window.navigation?window.navigation.addEventListener("navigate",()=>e()):(window.history.pushState=new Proxy(window.history.pushState,{apply:(n,r,u)=>{n.apply(r,u),e()}}),window.addEventListener("popstate",e),document.addEventListener("astro:page-load",()=>e())),e()};typeof window<"u"&&!window.__liwan_loaded&&i&&p();export{c as event};
